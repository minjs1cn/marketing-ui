var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r;import{i as c,f,r as s}from"./index.72a90d4c.js";import{d as u,h as l,o as h,e as p,t as y,b as d,j as g}from"./vendor.4fe08a48.js";import{R as b}from"./useRotate.9fd7a603.js";function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=j(t);if(e){var o=j(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _(this,n)}}function _(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?k(t):e}function k(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t){return t/180*Math.PI}function P(t,e){var n=0,r=0,o=360/t.length;t.forEach((function(t,i){r=(n=r)+(t.angle?t.angle:o),e(t,i,n,r)}))}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(i,b);var e,n,r,o=O(i);function i(t){var e,n,r,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this,t),n=k(e),a={},(r="options")in n?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,e}return e=i,(n=[{key:"ctx",get:function(){return this._ctx}},{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}},{key:"dpr",get:function(){return this._dpr}},{key:"el",get:function(){return this._el}},{key:"init",value:function(t){var e=t.el,n=t.dpr;return"string"==typeof e&&(e=document.querySelector(e)),this._ctx=e.getContext("2d"),this._dpr=n||window.devicePixelRatio,this._el=e,this.reset(),this}},{key:"reset",value:function(){var t=this.el,e=this.dpr,n=t.parentNode,r=n.offsetWidth,o=n.offsetHeight,i=t.getBoundingClientRect(),a=i.left,c=i.top;t.width=r*e,t.height=o*e,t.style.width="100%",t.style.height="100%",t.style.borderRadius="50%",this._offsetX=a,this._offsetY=c,this._w=t.width,this._h=t.height,this.clear()}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"drawOptions",value:function(t){var e=this,n=this.ctx,r=this.width;P(t,(function(t,o,i,a){e.options[o]={startAngle:i,endAngle:a},t.backgroundColor&&(n.save(),n.strokeStyle=t.backgroundColor,n.beginPath(),n.translate(r/2,r/2),n.lineWidth=r,n.arc(0,0,r/2,x(i),x(a)),n.stroke(),n.restore())}));var o=12*this.dpr;P(t,(function(t,e,i,a){t.title&&(n.save(),n.translate(r/2,r/2),n.rotate(x((i+a)/2+90)),n.textAlign="center",n.fillStyle=t.color||"#000",n.font=o+"px Microsoft YaHei",n.fillText(t.title,0,-1*(r/2-o/2)*.9),n.restore())}));var i=r/2/3;P(t,(function(t,e,o,a){t.image&&c(t.image).then((function(t){n.save(),n.translate(r/2,r/2),n.rotate(x((o+a)/2+90)),n.drawImage(t,i/2*-1,-1*(r/2-i/2),i,i),n.restore()})).catch()}))}},{key:"getAngleRangeByIndex",value:function(t){var e=this.options[t];return[270-(e.startAngle+e.endAngle)/2*2,270]}}])&&m(e.prototype,n),r&&m(e,r),i}();var S=u({setup(){const t=l({angle:0}),c=new R((e=>{t.angle=e}));h((()=>{c.init({el:"#my-turnTable"}).drawOptions(Array.from({length:8}).map(((t,e)=>({title:"1等奖",color:e%2==0?"#fff":"#f47920",image:`/option/option_${e+1}.png`,backgroundColor:e%2==0?"#f47920":"#fff"}))))}));const u=p((()=>({transform:`rotate3d(0, 0, 1, ${t.angle}deg)`})));return d=((t,e)=>{for(var n in e||(e={}))o.call(e,n)&&a(t,n,e[n]);if(r)for(var n of r(e))i.call(e,n)&&a(t,n,e[n]);return t})({style:u},y(t)),e(d,n({onStart:async()=>{c.start();const{data:t}=await f(s());c.to({duration:2e3,index:t,complete:()=>{console.log("中奖啦",t)}})}}));var d},render(){return d(g("demo-block"),null,{default:()=>[d("div",{class:"turntable"},[d("canvas",{id:"my-turnTable",style:this.style},null)])]})}});export default S;
